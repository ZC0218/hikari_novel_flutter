name: Windows Build & Code Check
on:
  workflow_dispatch:    # 仅保留手动触发，简化流程

jobs:
  build-windows:
    runs-on: windows-2022
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # 核心修改：安装Flutter 3.19.0（内置Dart 3.9.0，满足项目要求）
      - name: Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.38.5'  # 关键：升级到匹配Dart 3.9.2的版本
          channel: 'stable'

      - name: Flutter Doctor（查看版本匹配情况）
        run: flutter doctor -v

      - name: Code Analysis
        run: flutter analyze --no-fatal-warnings

      - name: Get Dependencies
        run: |
          flutter pub get
          flutter precache --windows

      - name: Clean Project
        run: flutter clean

      - name: Build Windows Release
        run: flutter build windows --release --verbose

      - name: Upload Build Artifact
        uses: actions/upload-artifact@v4
        with:
          name: windows-exe
          path: build/windows/runner/Release/
